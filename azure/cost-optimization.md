# Azure AKS 成本优化指南

## 💰 成本估算

### 基础配置成本（每月）

- **AKS 控制平面**: 免费
- **2 个 Standard_B2s 节点**: ~$60-80
- **ACR 基本版**: ~$5
- **网络流量**: ~$5-15
- **总计**: ~$70-100/月

## 🎯 优化策略

### 1. 使用 Spot 实例（节省 50-90%）

**通过 Azure 门户配置：**

1. 进入 AKS 集群 → 节点池
2. 添加节点池 → 启用 Azure Spot 实例
3. 设置逐出策略为"删除"
4. 最大价格设为-1（按需价格）

**预期节省**: $30-50/月

### 2. 启用集群自动缩放

**配置方法：**

1. 节点池设置 → 启用自动缩放
2. 最小节点：1，最大节点：5
3. 非工作时间自动缩减到最小配置

**预期节省**: $20-40/月

### 3. 使用更小的 VM 规格

**开发环境推荐：**

- `Standard_B1s` (1 核 1GB): ~$15/月/节点
- `Standard_B2s` (2 核 4GB): ~$30/月/节点

**生产环境推荐：**

- `Standard_D2s_v3` (2 核 8GB): ~$70/月/节点

### 4. 优化存储成本

**配置建议：**

- 使用标准 SSD 而非高级 SSD
- 定期清理未使用的持久卷
- 使用 Azure Files 而非高级存储

### 5. 网络成本优化

**策略：**

- 将所有资源放在同一区域
- 使用 Azure CDN 缓存静态内容
- 优化出站流量

## 📊 成本监控

### 1. 设置预算警报

1. Azure 门户 → 成本管理 + 计费
2. 预算 → 创建预算
3. 设置月度预算$100
4. 配置 80%和 100%警报

### 2. 使用成本分析

1. 成本管理 + 计费 → 成本分析
2. 按资源组筛选
3. 查看每日/每月趋势

### 3. 资源标记

为所有资源添加标记：

- Environment: Production/Development
- Project: E-Commerce
- Owner: YourName

## ⏰ 定时任务优化

### 开发环境自动关闭

创建 Azure 自动化脚本，在非工作时间关闭开发集群：

**时间安排：**

- 工作日：9:00 开启，18:00 关闭
- 周末：完全关闭

**预期节省：** 60-70%的计算成本

### 生产环境智能缩放

配置基于时间和负载的缩放策略：

- 高峰时段：3-5 个节点
- 低峰时段：1-2 个节点
- 深夜时段：1 个节点

## 🔧 实施步骤

### 第一周：基础优化

1. 启用集群自动缩放
2. 添加 Spot 节点池
3. 设置预算警报

### 第二周：高级优化

1. 实施定时缩放
2. 优化存储配置
3. 配置监控仪表板

### 第三周：持续优化

1. 分析成本报告
2. 调整缩放策略
3. 优化应用资源请求

## 📈 预期效果

**优化前：** $70-100/月
**优化后：** $25-40/月
**节省比例：** 60-70%

## ⚠️ 注意事项

### Spot 实例限制

- 可能被 Azure 随时回收
- 不适合关键生产工作负载
- 需要应用具备容错能力

### 自动缩放考虑

- 缩放需要时间（1-3 分钟）
- 可能影响应用启动时间
- 需要合理设置资源请求和限制

### 监控重要性

- 定期检查成本报告
- 监控应用性能影响
- 及时调整优化策略

通过这些优化措施，你可以在保证服务质量的同时，显著降低 Azure AKS 的运行成本。
