# Azure Key Vault Secret Provider (生产环境推荐)
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: backend-secrets
  namespace: ecommerce
spec:
  provider: azure
  parameters:
    usePodIdentity: 'false'
    useVMManagedIdentity: 'true'
    userAssignedIdentityID: 'your-managed-identity-client-id'
    keyvaultName: 'your-keyvault-name'
    objects: |
      array:
        - |
          objectName: openai-api-key
          objectType: secret
        - |
          objectName: google-api-key
          objectType: secret
        - |
          objectName: gemini-api-key
          objectType: secret
        - |
          objectName: xai-api-key
          objectType: secret
    tenantId: 'your-tenant-id'
---
# 使用 Key Vault 的部署示例
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment-secure
  namespace: ecommerce
spec:
  template:
    spec:
      containers:
        - name: backend
          env:
            - name: OPENAI_API_KEY
              valueFrom:
                secretKeyRef:
                  name: backend-secrets
                  key: openai-api-key
          volumeMounts:
            - name: secrets-store
              mountPath: '/mnt/secrets-store'
              readOnly: true
      volumes:
        - name: secrets-store
          csi:
            driver: secrets-store.csi.k8s.io
            readOnly: true
            volumeAttributes:
              secretProviderClass: 'backend-secrets'
